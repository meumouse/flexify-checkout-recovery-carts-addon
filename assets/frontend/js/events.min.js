!function(e){"use strict";const o=fcrc_events_params||{};o.debug_mode&&console.log("[DEBUG] FCRC events params:",o);var t={};const c={keepButtonState:function(e){var o=e.width(),t=e.height(),c=e.html();return e.width(o),e.height(t),{width:o,height:t,html:c}},openModal:function(){var t=o.triggers_list;e(t).hover((function(o){e("body").hasClass("fcrc-lead-collected")||e("body").hasClass("fcrc-lead-rejected")||"yes"===c.getCookie("fcrc_lead_collected")||e(".fcrc-popup-container.lead-capture-modal").addClass("show")})),e(document).on("click",".fcrc-popup-close",(function(o){o.preventDefault(),e(".fcrc-popup-container.lead-capture-modal").removeClass("show"),e("body").addClass("fcrc-lead-rejected")}))},collectLead:function(){e(document).on("click",".fcrc-trigger-send-lead",(function(n){n.preventDefault();const a=e(this),r=c.keepButtonState(a);var i=e(".fcrc-get-first-name").val()||c.getCookie("fcrc_first_name"),s=e(".fcrc-get-last-name").val()||c.getCookie("fcrc_last_name"),l=e(".fcrc-get-phone").val()||c.getCookie("fcrc_phone"),d=e(".fcrc-get-email").val()||c.getCookie("fcrc_email"),u=c.getCookie("fcrc_cart_id")||"";e.ajax({url:o.ajax_url,type:"POST",data:{action:"fcrc_lead_collected",first_name:i,last_name:s,phone:l,email:d,country_data:JSON.stringify(t),cart_id:u,ip_data:JSON.stringify(c.getCookie("fcrc_location"))},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){o.debug_mode&&console.log(t);try{"success"===t.status?(e("body").addClass("fcrc-lead-collected"),e(".fcrc-popup-container.lead-capture-modal").removeClass("show"),c.setCookie("fcrc_cart_id",t.cart_id,7),c.setCookie("fcrc_first_name",i,365),c.setCookie("fcrc_last_name",s,365),c.setCookie("fcrc_phone",l,365),c.setCookie("fcrc_email",d,365),c.setCookie("fcrc_lead_collected","yes",365)):e("body").removeClass("fcrc-lead-collected")}catch(e){console.log(e)}},error:function(){console.log("Error on send lead data")},complete:function(){a.prop("disabled",!1).html(r.html)}})}))},setCookie:function(e,o,t){let c="";if(t){let e=new Date;e.setTime(e.getTime()+24*t*60*60*1e3),c="; expires="+e.toUTCString()}document.cookie=e+"="+encodeURIComponent(o)+c+"; path=/"},getCookie:function(e){let o=document.cookie.match(new RegExp("(?:^|; )"+e.replace(/([\.\$?*|{}\(\)\[\]\/+^])/g,"\\$1")+"=([^;]*)"));return o?decodeURIComponent(o[1]):void 0},deleteCookie:function(e){document.cookie=e+"=; Max-Age=0; path=/; domain="+window.location.hostname},internationalPhone:function(){const e=document.querySelector(".fcrc-input.fcrc-get-phone");if(!e)return void(o.debug_mode&&console.warn("fcrc-get-phone input not found"));const n=window.intlTelInput(e,{loadUtilsOnInit:o.path_to_utils,autoPlaceholder:"aggressive",containerClass:"fcrc-international-phone-selector",initialCountry:"auto",geoIpLookup:async function(e,o){const t=c.getCookie("fcrc_phone_country_code");if(t)e(t);else{const t=await c.getLocationData();t&&t.country_code?(c.setCookie("fcrc_phone_country_code",t.country_code,7),e(t.country_code)):o("br")}},i18n:{searchPlaceholder:o.i18n.intl_search_input_placeholder}});setTimeout((()=>{t=n.getSelectedCountryData()}),500)},getIpAddress:function(){const e=o.ip_settings.get_ip;return fetch(e,{cache:"no-store"}).then((e=>{if(!e.ok)throw new Error("Network response was not ok");return e.json()})).then((e=>e.ip)).catch((e=>(console.error("Failed to fetch IP:",e),null)))},getLocationData:async function(){let e=c.getCookie("fcrc_location");if(o.debug_mode&&console.log("Country data cached:",e),e)try{e=JSON.parse(e);if(!(!e.ip||"undefined"===e.ip||"null"===e.ip))return e.cache=!0,e;c.deleteCookie("fcrc_location"),console.log("Invalid location cookie detected and removed.")}catch(e){c.deleteCookie("fcrc_location"),console.log("Corrupted location cookie detected and removed.")}try{const e=await c.getIpAddress(),t=o.ip_settings,n=t.ip_url.replace("{ip_address}",e)+"?_="+(new Date).getTime(),a=await fetch(n,{cache:"no-store"}),r=await a.json(),i={country_code:r[t.country_code]||"",country_name:r[t.country_name]||"",region:r[t.state_name]||"",city:r[t.city_name]||"",ip:r[t.ip_returned]||""};return o.debug_mode&&console.log("Country data:",i),c.setCookie("fcrc_location",JSON.stringify(i),7),i}catch(e){return console.error("Error fetching location:",e),null}},getUserLocation:async function(){const e=await c.getLocationData();e&&c.sendLocationData(e)},sendLocationData:function(t){let n=c.getCookie("fcrc_cart_id");n&&e.ajax({url:o.ajax_url,type:"POST",data:{action:"fcrc_update_location",cart_id:n,country_data:JSON.stringify(t)},success:function(e){o.debug_mode&&console.log("Location data sent:",e)},error:function(){console.error("Error sending location data.")}})},init:function(){this.collectLead(),"yes"===o.ip_settings.enabled&&this.getUserLocation(),o.is_product&&this.openModal(),"yes"===o.enable_international_phone&&o.is_product&&this.internationalPhone()}};jQuery(document).ready((function(e){c.init()}))}(jQuery);