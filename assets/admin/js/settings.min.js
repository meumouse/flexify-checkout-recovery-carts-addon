!function(e){"use strict";const t=fcrc_settings_params||{},o={activateTabs:function(){e(document).ready((function(){let t=window.location.hash,o=localStorage.getItem("fc_recovery_carts_get_admin_tab_index");if(t){let o=e('.fc-recovery-carts-wrapper a.nav-tab[href="'+t+'"]');o.length&&o.click()}else null!==o?e(".fc-recovery-carts-wrapper a.nav-tab").eq(o).click():e('.fc-recovery-carts-wrapper a.nav-tab[href="#general"]').click()})),e(document).on("click",".fc-recovery-carts-wrapper a.nav-tab",(function(){let t=e(this).index();localStorage.setItem("fc_recovery_carts_get_admin_tab_index",t);let o=e(this).attr("href");return e(".fc-recovery-carts-wrapper a.nav-tab").removeClass("nav-tab-active"),e(".fc-recovery-carts-form .nav-content").removeClass("active"),e(this).addClass("nav-tab-active"),e(".fc-recovery-carts-form").find(o).addClass("active"),!1}))},displayToast:function(o,n,i){var a="",s="",c="";"success"===o?(a="toast-success",s="bg-success text-white",c='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>'):"error"===o?(a="toast-danger",s="bg-danger text-white",c='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):"warning"===o?(a="toast-warning",s="bg-warning text-white",c='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'):(a="toast-secondary",s="bg-secondary text-white",c="");var r="toast-"+Math.random().toString(36).substr(2,9),l=`<div id="${r}" class="toast ${a} show">\n\t\t\t\t<div class="toast-header ${s}">\n\t\t\t\t\t\t${c}\n\t\t\t\t\t\t<span class="me-auto">${n}</span>\n\t\t\t\t\t\t<button class="btn-close btn-close-white ms-2 hide-toast" type="button" data-bs-dismiss="toast" aria-label="${t.i18n.toast_aria_label}"></button>\n\t\t\t\t</div>\n\t\t\t\t<div class="toast-body">${i}</div>\n\t\t\t</div>`;e(".fc-recovery-carts-wrapper").before(l),setTimeout((()=>{jQuery("#"+r).fadeOut("fast")}),3e3),setTimeout((()=>{jQuery("#"+r).remove()}),3500),e(document).on("click",".hide-toast",(function(){var t=e(".toast.show").attr("id");e("#"+t).fadeOut("fast"),setTimeout((function(){e("#"+t).remove()}),500)}))},displayModal:function(t,o,n){const i="string"==typeof t?t:"#"+t.attr("id"),a="string"==typeof o?o:"#"+o.attr("id"),s="string"==typeof n?n:"#"+n.attr("id");e(document).on("click",i,(function(t){t.preventDefault(),e(a).addClass("show")})),e(document).on("click",a,(function(t){t.target===this&&e(this).removeClass("show")})),e(document).on("click",s,(function(t){t.preventDefault(),e(a).removeClass("show")}))},keepButtonState:function(e){var t=e.width(),o=e.height(),n=e.html();return e.width(t),e.height(o),{width:t,height:o,html:n}},saveOptions:function(){let n=e('form[name="fc-recovery-carts-options-form"]'),i=n.serialize();e("#fcrc_save_options").on("click",(function(a){a.preventDefault();let s=e(this),c=o.keepButtonState(s);o.forceUncheckedCheckboxes(),e.ajax({url:t.ajax_url,type:"POST",data:{action:"fc_recovery_carts_save_options",nonce:t.ajax_nonce,form_data:n.serialize()},beforeSend:function(){s.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(e){t.debug_mode&&console.log(e);try{"success"===e.status?(i=n.serialize(),o.displayToast("success",e.toast_header_title,e.toast_body_title)):o.displayToast("error",e.toast_header_title,e.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){console.error("AJAX Error:",t,o)},complete:function(){s.html(c.html)}})})),n.on("change input","input, select, textarea",(function(){n.serialize()!==i?e("#fcrc_save_options").prop("disabled",!1):e("#fcrc_save_options").prop("disabled",!0)}))},forceUncheckedCheckboxes:function(){e('input[type="checkbox"]').each((function(){const t=e(this),o=t.attr("name");if(t.is(":checked"))t.siblings(".fcrc-hidden-checkbox").remove();else{const n=e("<input>").attr({type:"hidden",name:o,value:"no"}).addClass("fcrc-hidden-checkbox");t.siblings(".fcrc-hidden-checkbox").remove(),t.after(n)}}))},addNewFollowUp:function(){var n=e("#fcrc_add_new_follow_up_container");o.displayModal(e("#fcrc_add_new_follow_up_trigger"),n,e("#fcrc_add_new_follow_up_close")),e(document).on("click","#fcrc_add_new_follow_up_save",(function(i){i.preventDefault();let a=e(this),s=o.keepButtonState(a),c=e("#fcrc_add_new_follow_up_title"),r=e("#fcrc_add_new_follow_up_message"),l=e("#fcrc_add_new_follow_up_delay_time"),d=e("#fcrc_add_new_follow_up_delay_type"),p=e("#fcrc_add_new_follow_up_channels_whatsapp");var h={enabled:n.find(".enable-send-coupon").prop("checked")?"yes":"no",generate_coupon:n.find(".enable-generate-coupon").prop("checked")?"yes":"no",coupon_prefix:n.find(".get-coupon-prefix").val()||"",coupon_code:n.find(".get-coupon-code").val()||"",discount_type:n.find(".get-coupon-type").val()||"",discount_value:n.find(".get-coupon-value").val()||"",allow_free_shipping:n.find(".get-coupon-allow-free-shipping").prop("checked")?"yes":"no",expiration_time:n.find(".get-coupon-expire-time").val()||"",expiration_time_unit:n.find(".get-coupon-expire-time-type").val()||"",limit_usages:n.find(".get-coupon-limit-usage").val()||"",limit_usages_per_user:n.find(".get-coupon-limit-usage-per-user").val()||""};e.ajax({url:t.ajax_url,type:"POST",data:{action:"fcrc_add_new_follow_up",nonce:t.ajax_nonce,title:c.val()||"",message:r.val()||"",delay_time:l.val()||"",delay_type:d.val()||"",whatsapp:p.prop("checked")?"yes":"no",email:"",coupon:JSON.stringify(h)},beforeSend:function(){a.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){try{"success"===t.status?(e("#follow_up").find("ul.fcrc-follow-up-list").replaceWith(t.follow_up_list),o.emojiPicker(),e("#fcrc_add_new_follow_up_container").removeClass("show"),o.displayToast("success",t.toast_header_title,t.toast_body_title),c.val(""),r.val(""),l.val(""),d.val(""),p.prop("checked",!1)):o.displayToast("error",t.toast_header_title,t.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){a.prop("disabled",!1).html(s.html)}})}))},editFollowUp:function(){e(document).on("click",".edit-follow-up-item",(function(t){t.preventDefault();var o=e(this),n=o.siblings(".edit-follow-up-container"),i=o.siblings(".edit-follow-up-close");e("#"+n.attr("id")).addClass("show"),e(document).on("click","#"+n.attr("id"),(function(t){t.target===this&&e(this).removeClass("show")})),e(document).on("click","#"+i.attr("id"),(function(t){t.preventDefault(),e("#"+n.attr("id")).removeClass("show")}))})),e(document).on("change keyup input",".get-follow-up-title",(function(){let t=e(this).val();var o=e(".edit-follow-up-container.show").data("follow-up-item");e('.list-group-item[data-follow-up-item="'+o+'"]').find(".fcrc-follow-up-item-title").text(t)}))},deleteFollowUp:function(){e(document).on("click",".delete-follow-up-item",(function(n){n.preventDefault();var i=e(this),a=o.keepButtonState(i),s=i.data("follow-up-item");confirm(t.i18n.confirm_delete_follow_up)&&e.ajax({url:t.ajax_url,type:"POST",data:{action:"fcrc_delete_follow_up",nonce:t.ajax_nonce,event_key:s},beforeSend:function(){i.prop("disabled",!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(t){try{"success"===t.status?(e("#follow_up").find("ul.fcrc-follow-up-list").replaceWith(t.follow_up_list),o.displayToast("success",t.toast_header_title,t.toast_body_title)):o.displayToast("error",t.toast_header_title,t.toast_body_title)}catch(e){console.log(e)}},error:function(e,t,o){console.error("Error on AJAX request:",e.responseText)},complete:function(){i.prop("disabled",!1).html(a.html)}})}))},initWebhooks:function(){this.handleWebhookModals(),this.handleAddWebhook(),this.handleRemoveWebhook(),this.handleAddWebhookHeader(),this.handleRemoveWebhookHeader(),this.refreshWebhooksState()},getWebhookList:function(t){return e('.fcrc-webhook-list[data-event="'+t+'"]')},getHeadersContainer:function(t,o){return e('.fcrc-webhook-headers[data-event="'+t+'"][data-index="'+o+'"]')},toggleWebhookEmptyState:function(e){if(!e||!e.length)return;const t=e.siblings(".fcrc-webhook-empty");t.length&&t.toggleClass("d-none",e.children(".fcrc-webhook-item").length>0)},toggleHeadersEmptyState:function(e){if(!e||!e.length)return;const t=e.siblings(".fcrc-no-headers");t.length&&t.toggleClass("d-none",e.children(".fcrc-webhook-header-row").length>0)},updateWebhookCount:function(t){if(void 0===t)return;const n=o.getWebhookList(t),i=n.length?n.children(".fcrc-webhook-item").length:0,a=e('.fcrc-webhook-event[data-event-key="'+t+'"]').find(".fcrc-webhook-count");if(a.length){const e=a.data("countSingular"),t=a.data("countPlural");let o=i;if(void 0!==e&&void 0!==t){o=(1===i?e:t).replace("%d",i)}a.text(o)}},refreshWebhooksState:function(){e(".fcrc-webhook-list").each((function(){const t=e(this);o.toggleWebhookEmptyState(t),t.find(".fcrc-webhook-headers").each((function(){o.toggleHeadersEmptyState(e(this))}));const n=t.data("event");void 0!==n&&o.updateWebhookCount(n)}))},handleAddWebhook:function(){e(document).on("click",".fcrc-add-webhook",(function(t){t.preventDefault();const n=e(this).data("event"),i=e("#fcrc-webhook-template").html();if(void 0===n||!i)return;const a=o.getWebhookList(n);if(!a.length)return;let s=parseInt(a.data("nextIndex"),10);Number.isNaN(s)&&(s=a.children(".fcrc-webhook-item").length);const c=i.replace(/__event__/g,n).replace(/__index__/g,s);a.append(c),a.data("nextIndex",s+1),o.toggleWebhookEmptyState(a),o.addWebhookHeaderRow(n,s,!1),o.updateWebhookCount(n),e("#fcrc_save_options").prop("disabled",!1)}))},handleRemoveWebhook:function(){e(document).on("click",".fcrc-remove-webhook",(function(t){t.preventDefault();const n=e(this).closest(".fcrc-webhook-item"),i=n.closest(".fcrc-webhook-list");n.remove(),o.toggleWebhookEmptyState(i);const a=i.data("event");void 0!==a&&o.updateWebhookCount(a),e("#fcrc_save_options").prop("disabled",!1)}))},handleAddWebhookHeader:function(){e(document).on("click",".fcrc-add-webhook-header",(function(t){t.preventDefault();const n=e(this),i=n.data("event"),a=n.data("index");void 0!==i&&(o.addWebhookHeaderRow(i,a,!0),e("#fcrc_save_options").prop("disabled",!1))}))},handleRemoveWebhookHeader:function(){e(document).on("click",".fcrc-remove-webhook-header",(function(t){t.preventDefault();const n=e(this).closest(".fcrc-webhook-header-row"),i=n.closest(".fcrc-webhook-headers");n.remove(),o.toggleHeadersEmptyState(i),e("#fcrc_save_options").prop("disabled",!1)}))},handleWebhookModals:function(){e(document).on("click",".fcrc-configure-webhook",(function(t){t.preventDefault();const o=e(this).data("target");void 0!==o&&o&&e(o).addClass("show")})),e(document).on("click",".fcrc-webhook-modal",(function(t){t.target===this&&e(this).removeClass("show")})),e(document).on("click",".fcrc-webhook-modal-close",(function(t){t.preventDefault(),e(this).closest(".fcrc-webhook-modal").removeClass("show")}))},handleRemoveWebhookHeader:function(){e(document).on("click",".fcrc-remove-webhook-header",(function(t){t.preventDefault();const n=e(this).closest(".fcrc-webhook-header-row"),i=n.closest(".fcrc-webhook-headers");n.remove(),o.toggleHeadersEmptyState(i),e("#fcrc_save_options").prop("disabled",!1)}))},addWebhookHeaderRow:function(t,n,i){const a=o.getHeadersContainer(t,n),s=e("#fcrc-webhook-header-template").html();if(!a.length||!s)return;let c=parseInt(a.data("nextHeaderIndex"),10);Number.isNaN(c)&&(c=a.children(".fcrc-webhook-header-row").length);const r=s.replace(/__event__/g,t).replace(/__index__/g,n).replace(/__header_index__/g,c);a.append(r),a.data("nextHeaderIndex",c+1),o.toggleHeadersEmptyState(a),i&&a.find('.fcrc-webhook-header-row[data-header-index="'+c+'"]').last().find("input").first().trigger("focus")},visibilityController:function(t,o){let n=e(t).prop("checked");e(o).toggleClass("d-none",!n),e(t).on("click",(function(){n=e(this).prop("checked"),e(o).toggleClass("d-none",!n)}))},collectLeadSettings:function(){o.visibilityController("#enable_modal_add_to_cart","#collect_lead_modal_settings_trigger"),o.displayModal("#collect_lead_modal_settings_trigger","#collect_lead_modal_settings_container","#collect_lead_modal_settings_close")},selectColor:function(){e(".get-color-selected").on("input",(function(){var t=e(this).val();e(this).closest(".color-container").find(".form-control-color").val(t)})),e(".form-control-color").on("input",(function(){var t=e(this).val();e(this).closest(".color-container").find(".get-color-selected").val(t)})),e(".reset-color").on("click",(function(t){t.preventDefault();var o=e(this).data("color");e(this).closest(".color-container").find(".form-control-color").val(o),e(this).closest(".color-container").find(".get-color-selected").val(o).change()}))},joinotifySettings:function(){o.visibilityController("#enable_joinotify_integration","#fcrc_joinotify_settings_trigger"),o.displayModal("#fcrc_joinotify_settings_trigger","#fcrc_joinotify_settings_container","#fcrc_joinotify_settings_close")},integrationSettings:function(){o.joinotifySettings()},visibilityControllerForCoupons:function(){function t(e,t){let o=e.siblings(".generate-coupon-wrapper").find(".enable-generate-coupon").prop("checked");e.siblings(".generate-coupon-wrapper").toggleClass("d-none",!t),e.siblings(".coupon-preset-wrapper").toggleClass("d-none",!t),e.siblings(".coupon-prefix-wrapper").toggleClass("d-none",!t),e.siblings(".discount-type-wrapper").toggleClass("d-none",!t),e.siblings(".coupon-value-wrapper").toggleClass("d-none",!t),e.siblings(".coupon-allow-free-shipping-wrapper").toggleClass("d-none",!t),e.siblings(".coupon-expire-time-wrapper").toggleClass("d-none",!t),e.siblings(".restrictions-wrapper").toggleClass("d-none",!t),t&&(o?(e.siblings(".coupon-preset-wrapper").addClass("d-none"),e.siblings(".coupon-prefix-wrapper").removeClass("d-none")):(e.siblings(".coupon-preset-wrapper").removeClass("d-none"),e.siblings(".coupon-prefix-wrapper").addClass("d-none")))}e(document).on("change",".enable-send-coupon",(function(){let o=e(this).prop("checked");t(e(this).parent(".enable-send-coupon-wrapper"),o)})),e(".enable-send-coupon").each((function(){let o=e(this).prop("checked"),n=e(this).parent(".enable-send-coupon-wrapper");setTimeout((()=>{t(n,o)}),500)})),e(document).on("change",".enable-generate-coupon",(function(){let t=e(this).prop("checked"),o=e(this).parent(".generate-coupon-wrapper");o.siblings(".coupon-preset-wrapper").toggleClass("d-none",t),o.siblings(".coupon-prefix-wrapper").toggleClass("d-none",!t)})),e(".enable-generate-coupon").each((function(){let t=e(this).prop("checked"),o=e(this).parent(".generate-coupon-wrapper");o.siblings(".coupon-preset-wrapper").toggleClass("d-none",t),o.siblings(".coupon-prefix-wrapper").toggleClass("d-none",!t)}))},emojiPicker:function(){var o=t.i18n.emoji_picker;e(".add-emoji-picker").hasClass("emoji-initialized")||(setTimeout((()=>{e(".add-emoji-picker").emojioneArea({tones:!0,hidePickerOnBlur:!0,recentEmojis:!0,pickerPosition:"bottom",searchPlaceholder:o.placeholder,buttonTitle:o.button_title,filters:{tones:{title:o.filters.tones_title},recent:{title:o.filters.recent_title},smileys_people:{title:o.filters.smileys_people_title},animals_nature:{title:o.filters.animals_nature_title},food_drink:{title:o.filters.food_drink_title},activity:{title:o.filters.activity_title},travel_places:{title:o.filters.travel_places_title},objects:{title:o.filters.objects_title},symbols:{title:o.filters.symbols_title},flags:{title:o.filters.flags_title}}})}),500),e(".add-emoji-picker").addClass("emoji-initialized")),e(document).on("keyup change",".emojionearea-editor",(function(){var t=e(this).html();e(this).closest(".add-emoji-picker").val(t)}))},IpApiSettings:function(){o.visibilityController("#enable_get_location_from_ip","#ip_api_settings_trigger"),o.displayModal("#ip_api_settings_trigger","#ip_api_settings_container","#ip_api_settings_close")},init:function(){this.activateTabs(),this.saveOptions(),this.addNewFollowUp(),this.editFollowUp(),this.deleteFollowUp(),this.initWebhooks(),this.collectLeadSettings(),this.selectColor(),this.integrationSettings(),this.emojiPicker(),this.visibilityControllerForCoupons(),this.IpApiSettings()}};jQuery(document).ready((function(e){o.init()}))}(jQuery);