(function($){"use strict";const params=fcrc_settings_params||{};const Settings={activateTabs:function(){$(document).ready(function(){let url_hash=window.location.hash;let active_tab_index=localStorage.getItem('fc_recovery_carts_get_admin_tab_index');if(url_hash){let target_tab=$('.fc-recovery-carts-wrapper a.nav-tab[href="'+url_hash+'"]');if(target_tab.length){target_tab.click()}}else if(active_tab_index!==null){$('.fc-recovery-carts-wrapper a.nav-tab').eq(active_tab_index).click()}else{$('.fc-recovery-carts-wrapper a.nav-tab[href="#general"]').click()}});$(document).on('click','.fc-recovery-carts-wrapper a.nav-tab',function(){let tab_index=$(this).index();localStorage.setItem('fc_recovery_carts_get_admin_tab_index',tab_index);let attr_href=$(this).attr('href');$('.fc-recovery-carts-wrapper a.nav-tab').removeClass('nav-tab-active');$('.fc-recovery-carts-form .nav-content').removeClass('active');$(this).addClass('nav-tab-active');$('.fc-recovery-carts-form').find(attr_href).addClass('active');return!1})},displayToast:function(type,header_title,body_title){var toast_class='';var header_class='';var icon='';if(type==='success'){toast_class='toast-success';header_class='bg-success text-white';icon='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M9.999 13.587 7.7 11.292l-1.412 1.416 3.713 3.705 6.706-6.706-1.414-1.414z"></path></svg>'}else if(type==='error'){toast_class='toast-danger';header_class='bg-danger text-white';icon='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'}else if(type==='warning'){toast_class='toast-warning';header_class='bg-warning text-white';icon='<svg class="icon icon-white me-2" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2C6.486 2 2 6.486 2 12s4.486 10 10 10 10-4.486 10-10S17.514 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8z"></path><path d="M11 11h2v6h-2zm0-4h2v2h-2z"></path></svg>'}else{toast_class='toast-secondary';header_class='bg-secondary text-white';icon=''}
var toast_id='toast-'+Math.random().toString(36).substr(2,9);var toast_html=`<div id="${toast_id}" class="toast ${toast_class} show">
				<div class="toast-header ${header_class}">
						${icon}
						<span class="me-auto">${header_title}</span>
						<button class="btn-close btn-close-white ms-2 hide-toast" type="button" data-bs-dismiss="toast" aria-label="${params.i18n.toast_aria_label}"></button>
				</div>
				<div class="toast-body">${body_title}</div>
			</div>`;$('.fc-recovery-carts-wrapper').before(toast_html);setTimeout(()=>{jQuery('#'+toast_id).fadeOut('fast')},3000);setTimeout(()=>{jQuery('#'+toast_id).remove()},3500);$(document).on('click','.hide-toast',function(){var toast_id=$('.toast.show').attr('id');$('#'+toast_id).fadeOut('fast');setTimeout(function(){$('#'+toast_id).remove()},500)})},displayModal:function(trigger,container,close){const trigger_id=typeof trigger==='string'?trigger:'#'+trigger.attr('id');const container_id=typeof container==='string'?container:'#'+container.attr('id');const close_id=typeof close==='string'?close:'#'+close.attr('id');$(document).on('click',trigger_id,function(e){e.preventDefault();$(container_id).addClass('show')});$(document).on('click',container_id,function(e){if(e.target===this){$(this).removeClass('show')}});$(document).on('click',close_id,function(e){e.preventDefault();$(container_id).removeClass('show')})},keepButtonState:function(btn){var btn_width=btn.width();var btn_height=btn.height();var btn_html=btn.html();btn.width(btn_width);btn.height(btn_height);return{width:btn_width,height:btn_height,html:btn_html,}},saveOptions:function(){let settings_form=$('form[name="fc-recovery-carts-options-form"]');let original_values=settings_form.serialize();$('#fcrc_save_options').on('click',function(e){e.preventDefault();let btn=$(this);let btn_state=Settings.keepButtonState(btn);Settings.forceUncheckedCheckboxes();$.ajax({url:params.ajax_url,type:'POST',data:{action:'fc_recovery_carts_save_options',form_data:settings_form.serialize(),},beforeSend:function(){btn.prop('disabled',!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(response){if(params.debug_mode){console.log(response)}
try{if(response.status==='success'){original_values=settings_form.serialize();Settings.displayToast('success',response.toast_header_title,response.toast_body_title)}else{Settings.displayToast('error',response.toast_header_title,response.toast_body_title)}}catch(error){console.log(error)}},error:function(jqXHR,textStatus,errorThrown){console.error('AJAX Error:',textStatus,errorThrown)},complete:function(){btn.html(btn_state.html)},})});settings_form.on('change input','input, select, textarea',function(){if(settings_form.serialize()!==original_values){$('#fcrc_save_options').prop('disabled',!1)}else{$('#fcrc_save_options').prop('disabled',!0)}})},forceUncheckedCheckboxes:function(){$('input[type="checkbox"]').each(function(){const checkbox=$(this);const name=checkbox.attr('name');if(!checkbox.is(':checked')){const hiddenInput=$('<input>').attr({type:'hidden',name:name,value:'no'}).addClass('fcrc-hidden-checkbox');checkbox.siblings('.fcrc-hidden-checkbox').remove();checkbox.after(hiddenInput)}else{checkbox.siblings('.fcrc-hidden-checkbox').remove()}})},addNewFollowUp:function(){var container=$('#fcrc_add_new_follow_up_container');Settings.displayModal($('#fcrc_add_new_follow_up_trigger'),container,$('#fcrc_add_new_follow_up_close'));$(document).on('click','#fcrc_add_new_follow_up_save',function(e){e.preventDefault();let btn=$(this);let btn_state=Settings.keepButtonState(btn);let follow_up_title=$('#fcrc_add_new_follow_up_title');let follow_up_message=$('#fcrc_add_new_follow_up_message');let follow_up_delay_time=$('#fcrc_add_new_follow_up_delay_time');let follow_up_delay_type=$('#fcrc_add_new_follow_up_delay_type');let whatsapp_channel=$('#fcrc_add_new_follow_up_channels_whatsapp');var set_coupon={enabled:container.find('.enable-send-coupon').prop('checked')?'yes':'no',generate_coupon:container.find('.enable-generate-coupon').prop('checked')?'yes':'no',coupon_prefix:container.find('.get-coupon-prefix').val()||'',coupon_code:container.find('.get-coupon-code').val()||'',discount_type:container.find('.get-coupon-type').val()||'',discount_value:container.find('.get-coupon-value').val()||'',allow_free_shipping:container.find('.get-coupon-allow-free-shipping').prop('checked')?'yes':'no',expiration_time:container.find('.get-coupon-expire-time').val()||'',expiration_time_unit:container.find('.get-coupon-expire-time-type').val()||'',limit_usages:container.find('.get-coupon-limit-usage').val()||'',limit_usages_per_user:container.find('.get-coupon-limit-usage-per-user').val()||'',};$.ajax({url:params.ajax_url,type:'POST',data:{action:'fcrc_add_new_follow_up',title:follow_up_title.val()||'',message:follow_up_message.val()||'',delay_time:follow_up_delay_time.val()||'',delay_type:follow_up_delay_type.val()||'',whatsapp:whatsapp_channel.prop('checked')?'yes':'no',email:'',coupon:JSON.stringify(set_coupon),},beforeSend:function(){btn.prop('disabled',!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(response){try{if(response.status==='success'){$('#follow_up').find('ul.fcrc-follow-up-list').replaceWith(response.follow_up_list);Settings.emojiPicker();$('#fcrc_add_new_follow_up_container').removeClass('show');Settings.displayToast('success',response.toast_header_title,response.toast_body_title);follow_up_title.val('');follow_up_message.val('');follow_up_delay_time.val('');follow_up_delay_type.val('');whatsapp_channel.prop('checked',!1)}else{Settings.displayToast('error',response.toast_header_title,response.toast_body_title)}}catch(error){console.log(error)}},error:function(xhr,status,error){console.error('Error on AJAX request:',xhr.responseText)},complete:function(){btn.prop('disabled',!1).html(btn_state.html)},})})},editFollowUp:function(){$(document).on('click','.edit-follow-up-item',function(e){e.preventDefault();var trigger=$(this);var container=trigger.siblings('.edit-follow-up-container');var close=trigger.siblings('.edit-follow-up-close');$('#'+container.attr('id')).addClass('show');$(document).on('click','#'+container.attr('id'),function(e){if(e.target===this){$(this).removeClass('show')}});$(document).on('click','#'+close.attr('id'),function(e){e.preventDefault();$('#'+container.attr('id')).removeClass('show')})});$(document).on('change keyup input','.get-follow-up-title',function(){let value=$(this).val();var get_item=$('.edit-follow-up-container.show').data('follow-up-item');$('.list-group-item[data-follow-up-item="'+get_item+'"]').find('.fcrc-follow-up-item-title').text(value)})},deleteFollowUp:function(){$(document).on('click','.delete-follow-up-item',function(e){e.preventDefault();var btn=$(this);var btn_state=Settings.keepButtonState(btn);var get_item=btn.data('follow-up-item');if(!confirm(params.i18n.confirm_delete_follow_up)){return}
$.ajax({url:params.ajax_url,type:'POST',data:{action:'fcrc_delete_follow_up',event_key:get_item,},beforeSend:function(){btn.prop('disabled',!0).html('<span class="spinner-border spinner-border-sm"></span>')},success:function(response){try{if(response.status==='success'){$('#follow_up').find('ul.fcrc-follow-up-list').replaceWith(response.follow_up_list);Settings.displayToast('success',response.toast_header_title,response.toast_body_title)}else{Settings.displayToast('error',response.toast_header_title,response.toast_body_title)}}catch(error){console.log(error)}},error:function(xhr,status,error){console.error('Error on AJAX request:',xhr.responseText)},complete:function(){btn.prop('disabled',!1).html(btn_state.html)},})})},initWebhooks:function(){this.handleAddWebhook();this.handleRemoveWebhook();this.handleAddWebhookHeader();this.handleRemoveWebhookHeader();this.refreshWebhooksState()},getWebhookList:function(eventKey){return $('.fcrc-webhook-list[data-event="'+eventKey+'"]')},getHeadersContainer:function(eventKey,webhookIndex){return $('.fcrc-webhook-headers[data-event="'+eventKey+'"][data-index="'+webhookIndex+'"]')},toggleWebhookEmptyState:function(list){if(!list||!list.length){return}
const emptyState=list.siblings('.fcrc-webhook-empty');if(emptyState.length){emptyState.toggleClass('d-none',list.children('.fcrc-webhook-item').length>0)}},toggleHeadersEmptyState:function(container){if(!container||!container.length){return}
const emptyState=container.siblings('.fcrc-no-headers');if(emptyState.length){emptyState.toggleClass('d-none',container.children('.fcrc-webhook-header-row').length>0)}},refreshWebhooksState:function(){$('.fcrc-webhook-list').each(function(){const list=$(this);Settings.toggleWebhookEmptyState(list);list.find('.fcrc-webhook-headers').each(function(){Settings.toggleHeadersEmptyState($(this))})})},handleAddWebhook:function(){$(document).on('click','.fcrc-add-webhook',function(e){e.preventDefault();const button=$(this);const eventKey=button.data('event');const template=$('#fcrc-webhook-template').html();if(typeof eventKey==='undefined'||!template){return}
const list=Settings.getWebhookList(eventKey);if(!list.length){return}
let nextIndex=parseInt(list.data('nextIndex'),10);if(Number.isNaN(nextIndex)){nextIndex=list.children('.fcrc-webhook-item').length}
const webhookHtml=template.replace(/__event__/g,eventKey).replace(/__index__/g,nextIndex);list.append(webhookHtml);list.data('nextIndex',nextIndex+1);Settings.toggleWebhookEmptyState(list);Settings.addWebhookHeaderRow(eventKey,nextIndex,!1);$('#fcrc_save_options').prop('disabled',!1)})},handleRemoveWebhook:function(){$(document).on('click','.fcrc-remove-webhook',function(e){e.preventDefault();const item=$(this).closest('.fcrc-webhook-item');const list=item.closest('.fcrc-webhook-list');item.remove();Settings.toggleWebhookEmptyState(list);$('#fcrc_save_options').prop('disabled',!1)})},handleAddWebhookHeader:function(){$(document).on('click','.fcrc-add-webhook-header',function(e){e.preventDefault();const button=$(this);const eventKey=button.data('event');const webhookIndex=button.data('index');if(typeof eventKey==='undefined'){return}
Settings.addWebhookHeaderRow(eventKey,webhookIndex,!0);$('#fcrc_save_options').prop('disabled',!1)})},handleRemoveWebhookHeader:function(){$(document).on('click','.fcrc-remove-webhook-header',function(e){e.preventDefault();const row=$(this).closest('.fcrc-webhook-header-row');const container=row.closest('.fcrc-webhook-headers');row.remove();Settings.toggleHeadersEmptyState(container);$('#fcrc_save_options').prop('disabled',!1)})},addWebhookHeaderRow:function(eventKey,webhookIndex,focusInput){const headersContainer=Settings.getHeadersContainer(eventKey,webhookIndex);const template=$('#fcrc-webhook-header-template').html();if(!headersContainer.length||!template){return}
let nextHeaderIndex=parseInt(headersContainer.data('nextHeaderIndex'),10);if(Number.isNaN(nextHeaderIndex)){nextHeaderIndex=headersContainer.children('.fcrc-webhook-header-row').length}
const headerHtml=template.replace(/__event__/g,eventKey).replace(/__index__/g,webhookIndex).replace(/__header_index__/g,nextHeaderIndex);headersContainer.append(headerHtml);headersContainer.data('nextHeaderIndex',nextHeaderIndex+1);Settings.toggleHeadersEmptyState(headersContainer);if(focusInput){headersContainer.find('.fcrc-webhook-header-row[data-header-index="'+nextHeaderIndex+'"]').last().find('input').first().trigger('focus')}},visibilityController:function(selector,container){let checked=$(selector).prop('checked');$(container).toggleClass('d-none',!checked);$(selector).on('click',function(){checked=$(this).prop('checked');$(container).toggleClass('d-none',!checked)})},collectLeadSettings:function(){Settings.visibilityController('#enable_modal_add_to_cart','#collect_lead_modal_settings_trigger');Settings.displayModal('#collect_lead_modal_settings_trigger','#collect_lead_modal_settings_container','#collect_lead_modal_settings_close')},selectColor:function(){$('.get-color-selected').on('input',function(){var color_value=$(this).val();$(this).closest('.color-container').find('.form-control-color').val(color_value)});$('.form-control-color').on('input',function(){var color_value=$(this).val();$(this).closest('.color-container').find('.get-color-selected').val(color_value)});$('.reset-color').on('click',function(e){e.preventDefault();var color_value=$(this).data('color');$(this).closest('.color-container').find('.form-control-color').val(color_value);$(this).closest('.color-container').find('.get-color-selected').val(color_value).change()})},joinotifySettings:function(){Settings.visibilityController('#enable_joinotify_integration','#fcrc_joinotify_settings_trigger');Settings.displayModal('#fcrc_joinotify_settings_trigger','#fcrc_joinotify_settings_container','#fcrc_joinotify_settings_close')},integrationSettings:function(){Settings.joinotifySettings()},visibilityControllerForCoupons:function(){function display_coupon_wrappers(container,toggle){let generate_enabled=container.siblings('.generate-coupon-wrapper').find('.enable-generate-coupon').prop('checked');container.siblings('.generate-coupon-wrapper').toggleClass('d-none',!toggle);container.siblings('.coupon-preset-wrapper').toggleClass('d-none',!toggle);container.siblings('.coupon-prefix-wrapper').toggleClass('d-none',!toggle);container.siblings('.discount-type-wrapper').toggleClass('d-none',!toggle);container.siblings('.coupon-value-wrapper').toggleClass('d-none',!toggle);container.siblings('.coupon-allow-free-shipping-wrapper').toggleClass('d-none',!toggle);container.siblings('.coupon-expire-time-wrapper').toggleClass('d-none',!toggle);container.siblings('.restrictions-wrapper').toggleClass('d-none',!toggle);if(toggle){if(generate_enabled){container.siblings('.coupon-preset-wrapper').addClass('d-none');container.siblings('.coupon-prefix-wrapper').removeClass('d-none')}else{container.siblings('.coupon-preset-wrapper').removeClass('d-none');container.siblings('.coupon-prefix-wrapper').addClass('d-none')}}}
$(document).on('change','.enable-send-coupon',function(){let enabled=$(this).prop('checked');let container=$(this).parent('.enable-send-coupon-wrapper');display_coupon_wrappers(container,enabled)});$('.enable-send-coupon').each(function(){let enabled=$(this).prop('checked');let container=$(this).parent('.enable-send-coupon-wrapper');setTimeout(()=>{display_coupon_wrappers(container,enabled)},500)});$(document).on('change','.enable-generate-coupon',function(){let enabled=$(this).prop('checked');let container=$(this).parent('.generate-coupon-wrapper');container.siblings('.coupon-preset-wrapper').toggleClass('d-none',enabled);container.siblings('.coupon-prefix-wrapper').toggleClass('d-none',!enabled)});$('.enable-generate-coupon').each(function(){let enabled=$(this).prop('checked');let container=$(this).parent('.generate-coupon-wrapper');container.siblings('.coupon-preset-wrapper').toggleClass('d-none',enabled);container.siblings('.coupon-prefix-wrapper').toggleClass('d-none',!enabled)})},emojiPicker:function(){var i18n=params.i18n.emoji_picker;if(!$('.add-emoji-picker').hasClass('emoji-initialized')){setTimeout(()=>{$('.add-emoji-picker').emojioneArea({tones:!0,hidePickerOnBlur:!0,recentEmojis:!0,pickerPosition:'bottom',searchPlaceholder:i18n.placeholder,buttonTitle:i18n.button_title,filters:{tones:{title:i18n.filters.tones_title,},recent:{title:i18n.filters.recent_title,},smileys_people:{title:i18n.filters.smileys_people_title,},animals_nature:{title:i18n.filters.animals_nature_title,},food_drink:{title:i18n.filters.food_drink_title,},activity:{title:i18n.filters.activity_title,},travel_places:{title:i18n.filters.travel_places_title,},objects:{title:i18n.filters.objects_title,},symbols:{title:i18n.filters.symbols_title,},flags:{title:i18n.filters.flags_title,},},})},500);$('.add-emoji-picker').addClass('emoji-initialized')}
$(document).on('keyup change','.emojionearea-editor',function(){var content=$(this).html();$(this).closest('.add-emoji-picker').val(content)})},IpApiSettings:function(){Settings.visibilityController('#enable_get_location_from_ip','#ip_api_settings_trigger');Settings.displayModal('#ip_api_settings_trigger','#ip_api_settings_container','#ip_api_settings_close')},init:function(){this.activateTabs();this.saveOptions();this.addNewFollowUp();this.editFollowUp();this.deleteFollowUp();this.initWebhooks();this.collectLeadSettings();this.selectColor();this.integrationSettings();this.emojiPicker();this.visibilityControllerForCoupons();this.IpApiSettings()},};jQuery(document).ready(function($){Settings.init()})})(jQuery)